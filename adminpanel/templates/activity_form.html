<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Learning Activity</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 30px; }
        textarea { width: 100%; height: 120px; margin-bottom: 15px; }
        select { padding: 5px; margin-left: 10px; }
        button { padding: 10px 20px; cursor: pointer; margin-top: 10px; }
        .output { margin-top: 30px; padding: 15px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<h2>What do you want to learn?</h2>

<textarea id="content" placeholder="Enter your text here..." required></textarea>

<label>
    Difficulty:
    <select id="difficulty">
        <option value="1">Easy</option>
        <option value="2" selected>Medium</option>
        <option value="3">Advanced</option>
    </select>
</label>

<br><br>
<button onclick="submitLearning()">Submit</button>

<div class="output">
    <h3>AI Response</h3>
    <p><strong>Summary:</strong></p>
    <p id="summary">—</p>

    <p><strong>Key Points:</strong></p>
    <ul id="bullets"></ul>

    <p><strong>Confidence Score:</strong></p>
    <p id="confidence">—</p>
</div>

<script>
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function submitLearning() {
    const userText = document.getElementById("content").value;
    const difficultyLevel = document.getElementById("difficulty").value;

    if (!userText.trim()) {
        alert("Please enter some text");
        return;
    }

    fetch("/api/responses/submit/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie('csrftoken')
        },
        body: JSON.stringify({
            transcript: userText,
            difficulty: difficultyLevel
        })
    })
    .then(res => res.json())
    .then(data => {
        if(data.error){
            alert(data.error);
            return;
        }
        document.getElementById("summary").innerText = data.summary;
        document.getElementById("confidence").innerText = data.confidence + "%";

        const bulletsList = document.getElementById("bullets");
        bulletsList.innerHTML = "";
        data.bullets.forEach(point => {
            const li = document.createElement("li");
            li.innerText = point;
            bulletsList.appendChild(li);
        });
    })
    .catch(err => {
        console.error(err);
        alert("Error fetching AI response");
    });
}
</script>

</body>
</html>
